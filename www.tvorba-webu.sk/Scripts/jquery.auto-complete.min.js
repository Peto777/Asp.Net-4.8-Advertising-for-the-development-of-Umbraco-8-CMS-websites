(function(n){n.fn.autoComplete=function(t){var i=n.extend({},n.fn.autoComplete.defaults,t);return typeof t=="string"?(this.each(function(){var i=n(this);t=="destroy"&&(n(window).off("resize.autocomplete",i.updateSC),i.off("blur.autocomplete focus.autocomplete keydown.autocomplete keyup.autocomplete"),i.data("autocomplete")?i.attr("autocomplete",i.data("autocomplete")):i.removeAttr("autocomplete"),n(i.data("sc")).remove(),i.removeData("sc").removeData("autocomplete"))}),this):this.each(function(){function r(n){var u=t.val(),f,r;if(t.cache[u]=n,n.length&&u.length>=i.minChars){for(f="",r=0;r<n.length;r++)f+=i.renderItem(n[r],u);t.sc.html(f);t.updateSC(0)}else t.sc.hide()}var t=n(this);t.sc=n('<div class="autocomplete-suggestions '+i.menuClass+'"><\/div>');t.data("sc",t.sc).data("autocomplete",t.attr("autocomplete"));t.attr("autocomplete","off");t.cache={};t.last_val="";t.updateSC=function(i,r){if(t.sc.css({top:t.offset().top+t.outerHeight(),left:t.offset().left,width:t.outerWidth()}),!i&&(t.sc.show(),t.sc.maxHeight||(t.sc.maxHeight=parseInt(t.sc.css("max-height"))),t.sc.suggestionHeight||(t.sc.suggestionHeight=n(".autocomplete-suggestion",t.sc).first().outerHeight()),t.sc.suggestionHeight))if(r){var f=t.sc.scrollTop(),u=r.offset().top-t.sc.offset().top;u+t.sc.suggestionHeight-t.sc.maxHeight>0?t.sc.scrollTop(u+t.sc.suggestionHeight+f-t.sc.maxHeight):u<0&&t.sc.scrollTop(u+f)}else t.sc.scrollTop(0)};n(window).on("resize.autocomplete",t.updateSC);t.sc.appendTo("body");t.sc.on("mouseleave",".autocomplete-suggestion",function(){n(".autocomplete-suggestion.selected").removeClass("selected")});t.sc.on("mouseenter",".autocomplete-suggestion",function(){n(".autocomplete-suggestion.selected").removeClass("selected");n(this).addClass("selected")});t.sc.on("mousedown click",".autocomplete-suggestion",function(r){var u=n(this),f=u.data("val");if(f||u.hasClass("autocomplete-suggestion")){t.val(f);i.onSelect(r,f,u);t.sc.hide()}return!1});t.on("blur.autocomplete",function(){try{over_sb=n(".autocomplete-suggestions:hover").length}catch(i){over_sb=0}over_sb?t.is(":focus")||setTimeout(function(){t.focus()},20):(t.last_val=t.val(),t.sc.hide(),setTimeout(function(){t.sc.hide()},350))});if(!i.minChars)t.on("focus.autocomplete",function(){t.last_val="\n";t.trigger("keyup.autocomplete")});t.on("keydown.autocomplete",function(r){var f,u;if((r.which==40||r.which==38)&&t.sc.html())return u=n(".autocomplete-suggestion.selected",t.sc),u.length?(f=r.which==40?u.next(".autocomplete-suggestion"):u.prev(".autocomplete-suggestion"),f.length?(u.removeClass("selected"),t.val(f.addClass("selected").data("val"))):(u.removeClass("selected"),t.val(t.last_val),f=0)):(f=r.which==40?n(".autocomplete-suggestion",t.sc).first():n(".autocomplete-suggestion",t.sc).last(),t.val(f.addClass("selected").data("val"))),t.updateSC(0,f),!1;if(r.which==27)t.val(t.last_val).sc.hide();else if((r.which==13||r.which==9)&&(u=n(".autocomplete-suggestion.selected",t.sc),u.length&&t.sc.is(":visible"))){i.onSelect(r,u.data("val"),u);setTimeout(function(){t.sc.hide()},20)}});t.on("keyup.autocomplete",function(u){var f,e,o;if(!~n.inArray(u.which,[13,27,35,36,37,38,39,40]))if(f=t.val(),f.length>=i.minChars){if(f!=t.last_val){if(t.last_val=f,clearTimeout(t.timer),i.cache){if(f in t.cache){r(t.cache[f]);return}for(e=1;e<f.length-i.minChars;e++)if(o=f.slice(0,f.length-e),o in t.cache&&!t.cache[o].length){r([]);return}}t.timer=setTimeout(function(){i.source(f,r)},i.delay)}}else t.last_val=f,t.sc.hide()})})};n.fn.autoComplete.defaults={source:0,minChars:3,delay:150,cache:1,menuClass:"",renderItem:function(n,t){t=t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");var i=new RegExp("("+t.split(" ").join("|")+")","gi");return'<div class="autocomplete-suggestion" data-val="'+n+'">'+n.replace(i,"<b>$1<\/b>")+"<\/div>"},onSelect:function(){}}})(jQuery);